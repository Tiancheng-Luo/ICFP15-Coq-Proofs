<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<link href="coqdoc.css" rel="stylesheet" type="text/css" />
<title>validateWrite</title>
</head>

<body>

<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library validateWrite</h1>

<div class="code">
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Export</span> <span class="id" title="var">semantics</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab10"></a><h1 class="section">Theorems pertaining to validating a log before and after a write</h1>


<div class="paragraph"> </div>


<div class="paragraph"> </div>

If we update the heap with some location that does not exist
in the log, then it must still be in the result heaps.  This corresponds 
to the case where we are writing a location for the first time in a 
transaction, i.e. the lock was not previously been acquired

</div>
<div class="code">
<span class="id" title="keyword">Theorem</span> <span class="id" title="var">validateNotIn</span> : <br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">tid</span> <span class="id" title="var">l</span> <span class="id" title="var">v</span> <span class="id" title="var">b</span> <span class="id" title="var">v''</span> <span class="id" title="var">lock'''</span> <span class="id" title="var">rv</span> <span class="id" title="var">wv</span> <span class="id" title="var">e0</span> <span class="id" title="var">L</span> <span class="id" title="var">H</span> <span class="id" title="var">lock'</span> <span class="id" title="var">chkpnt</span> <span class="id" title="var">HI</span> <span class="id" title="var">HV</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Log.notIn</span> <span class="id" title="var">l</span> <span class="id" title="var">b</span> <span class="id" title="var">L</span> -&gt; <span class="id" title="var">H</span> <span class="id" title="var">l</span> = <span class="id" title="var">Some</span>(<span class="id" title="var">v''</span>, <span class="id" title="var">lock'''</span>) -&gt; <span class="id" title="var">validStamp</span> <span class="id" title="var">tid</span> <span class="id" title="var">rv</span> <span class="id" title="var">lock'''</span> -&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;@<span class="id" title="var">validate</span> <span class="id" title="var">tid</span> <span class="id" title="var">rv</span> <span class="id" title="var">wv</span> <span class="id" title="var">e0</span> <span class="id" title="var">b</span> <span class="id" title="var">L</span> (<span class="id" title="var">update</span> <span class="id" title="var">H</span> <span class="id" title="var">l</span> <span class="id" title="var">v</span> <span class="id" title="var">lock'</span>) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">commit</span> <span class="id" title="var">chkpnt</span> <span class="id" title="var">HI</span> <span class="id" title="var">HV</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;@<span class="id" title="var">validate</span> <span class="id" title="var">tid</span> <span class="id" title="var">rv</span> <span class="id" title="var">wv</span> <span class="id" title="var">e0</span> <span class="id" title="var">b</span> <span class="id" title="var">L</span> <span class="id" title="var">H</span> (<span class="id" title="var">commit</span> <span class="id" title="var">chkpnt</span> (<span class="id" title="var">update</span> <span class="id" title="var">HI</span> <span class="id" title="var">l</span> <span class="id" title="var">v''</span> <span class="id" title="var">lock'''</span>) (<span class="id" title="var">update</span> <span class="id" title="var">HV</span> <span class="id" title="var">l</span> <span class="id" title="var">v''</span> <span class="id" title="var">lock'''</span>)).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">tid</span> <span class="id" title="var">l</span> <span class="id" title="var">v</span> <span class="id" title="var">b</span> <span class="id" title="var">v''</span> <span class="id" title="var">lock'''</span> <span class="id" title="var">rv</span> <span class="id" title="var">wv</span> <span class="id" title="var">e0</span> <span class="id" title="var">L</span> <span class="id" title="var">H</span> <span class="id" title="var">lock'</span> <span class="id" title="var">chkpnt</span> <span class="id" title="var">HI</span> <span class="id" title="var">HV</span> <span class="id" title="var">H0</span> <span class="id" title="var">H1</span> <span class="id" title="var">HV2</span> <span class="id" title="var">H3</span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">remember</span> (<span class="id" title="var">update</span> <span class="id" title="var">H</span> <span class="id" title="var">l</span> <span class="id" title="var">v</span> <span class="id" title="var">lock'</span>). <span class="id" title="var">remember</span> (<span class="id" title="var">commit</span> <span class="id" title="var">chkpnt</span> <span class="id" title="var">HI</span> <span class="id" title="var">HV</span>).<br/>
&nbsp;&nbsp;<span class="id" title="var">genDeps</span>{{<span class="id" title="var">chkpnt</span>; <span class="id" title="var">HI</span>; <span class="id" title="var">HV</span>; <span class="id" title="var">H</span>; <span class="id" title="var">l</span>; <span class="id" title="var">v</span>; <span class="id" title="var">lock'</span>; <span class="id" title="var">lock'''</span>}}.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">H3</span>; <span class="id" title="tactic">intros</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">solve</span>[<span class="id" title="var">inv</span> <span class="id" title="var">Heqv0</span>].<br/>
&nbsp;&nbsp;{<span class="id" title="var">inv</span> <span class="id" title="var">Heqv0</span>. <span class="id" title="tactic">subst</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">updateUpdate</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">updateIdempotent</span>. <span class="id" title="tactic">constructor</span>. <span class="id" title="var">eassumption</span>. }<br/>
&nbsp;&nbsp;{<span class="id" title="var">inv</span> <span class="id" title="var">Heqv0</span>. <span class="id" title="var">invertHyp</span>. <span class="id" title="var">heapUnfold</span>. <span class="id" title="tactic">destruct</span> (<span class="id" title="var">Nat.eq_dec</span> <span class="id" title="var">l0</span> <span class="id" title="var">l</span>).<br/>
&nbsp;&nbsp;&nbsp;{<span class="id" title="tactic">subst</span>. <span class="id" title="var">invertEq</span>. <span class="id" title="tactic">econstructor</span>; <span class="id" title="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;{<span class="id" title="tactic">econstructor</span>; <span class="id" title="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<span class="id" title="var">inv</span> <span class="id" title="var">Heqv0</span>. <span class="id" title="var">invertHyp</span>. <span class="id" title="var">heapUnfold</span>. <span class="id" title="tactic">destruct</span> (<span class="id" title="var">Nat.eq_dec</span> <span class="id" title="var">l0</span> <span class="id" title="var">l</span>).<br/>
&nbsp;&nbsp;&nbsp;{<span class="id" title="tactic">subst</span>. <span class="id" title="var">invertEq</span>. <span class="id" title="tactic">econstructor</span>; <span class="id" title="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;{<span class="id" title="tactic">econstructor</span>; <span class="id" title="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<span class="id" title="var">inv</span> <span class="id" title="var">Heqv0</span>. <span class="id" title="var">invertHyp</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">updatecomm</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">updatecomm</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">l</span> := <span class="id" title="var">l</span>) (<span class="id" title="var">l'</span> := <span class="id" title="var">l0</span>); <span class="id" title="tactic">auto</span>. <span class="id" title="var">heapUnfold</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">econstructor</span>; <span class="id" title="tactic">eauto</span>. <span class="id" title="tactic">destruct</span> (<span class="id" title="var">Nat.eq_dec</span> <span class="id" title="var">l0</span> <span class="id" title="var">l</span>). <span class="id" title="var">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assumption</span>. }<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
If we update the heap with some location that does exist
in the log, then the "invalid" heaps will be the same.  The 
valid heaps however, will differ by the value associated with `l`.
The non-updated heap will contain the previously written value, `v''`
and the result of validating with the updated heap will have the 
newly updated value `v`.

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Theorem</span> <span class="id" title="var">validateIn</span> :  <br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">tid</span> <span class="id" title="var">l</span> <span class="id" title="var">v</span> <span class="id" title="var">v''</span> <span class="id" title="var">rv</span> <span class="id" title="var">wv</span> <span class="id" title="var">e0</span> <span class="id" title="var">L</span> <span class="id" title="var">H</span> <span class="id" title="var">lock'</span> <span class="id" title="var">chkpnt</span> <span class="id" title="var">HI</span> <span class="id" title="var">HV</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Log.In</span> <span class="id" title="var">l</span> <span class="id" title="var">L</span> -&gt; <span class="id" title="var">H</span> <span class="id" title="var">l</span> = <span class="id" title="var">Some</span>(<span class="id" title="var">v''</span>, <span class="id" title="var">lock'</span>) -&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;@<span class="id" title="var">validate</span> <span class="id" title="var">tid</span> <span class="id" title="var">rv</span> <span class="id" title="var">wv</span> <span class="id" title="var">e0</span> <span class="id" title="var">true</span> <span class="id" title="var">L</span> (<span class="id" title="var">update</span> <span class="id" title="var">H</span> <span class="id" title="var">l</span> <span class="id" title="var">v</span> <span class="id" title="var">lock'</span>) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">commit</span> <span class="id" title="var">chkpnt</span> <span class="id" title="var">HI</span> <span class="id" title="var">HV</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;@<span class="id" title="var">validate</span> <span class="id" title="var">tid</span> <span class="id" title="var">rv</span> <span class="id" title="var">wv</span> <span class="id" title="var">e0</span> <span class="id" title="var">true</span> <span class="id" title="var">L</span> <span class="id" title="var">H</span> (<span class="id" title="var">commit</span> <span class="id" title="var">chkpnt</span> <span class="id" title="var">HI</span> (<span class="id" title="var">update</span> <span class="id" title="var">HV</span> <span class="id" title="var">l</span> <span class="id" title="var">v''</span> (<span class="id" title="var">Unlocked</span> <span class="id" title="var">wv</span>))).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">dependent</span> <span class="id" title="tactic">induction</span> <span class="id" title="var">H2</span>.<br/>
&nbsp;&nbsp;{<span class="id" title="var">invertHyp</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">IHvalidate</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H0</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="var">heapUnfold</span>. <span class="id" title="tactic">destruct</span> (<span class="id" title="var">Nat.eq_dec</span> <span class="id" title="var">l</span> <span class="id" title="var">l0</span>).<br/>
&nbsp;&nbsp;&nbsp;{<span class="id" title="tactic">subst</span>. <span class="id" title="var">invertEq</span>. <span class="id" title="tactic">econstructor</span>; <span class="id" title="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;{<span class="id" title="tactic">econstructor</span>; <span class="id" title="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<span class="id" title="var">invertHyp</span>.<br/>
&nbsp;&nbsp;&nbsp;{<span class="id" title="var">heapUnfold</span>. <span class="id" title="tactic">destruct</span> (<span class="id" title="var">Nat.eq_dec</span> <span class="id" title="var">l0</span> <span class="id" title="var">l0</span>). <span class="id" title="var">Focus</span> 2. <span class="id" title="var">exfalso</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">invertEq</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">validateNotIn</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H0</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">erewrite</span> &lt;- <span class="id" title="var">updateUpdate</span>. <span class="id" title="var">erewrite</span> &lt;- <span class="id" title="var">updateUpdate</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">H</span> := (<span class="id" title="var">update</span> <span class="id" title="var">HV0</span> <span class="id" title="var">l0</span> <span class="id" title="var">v0</span> (<span class="id" title="var">Unlocked</span> <span class="id" title="var">wv</span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">econstructor</span>; <span class="id" title="tactic">eauto</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">updateUpdate</span>. <span class="id" title="var">eassumption</span>. <span class="id" title="tactic">constructor</span>. }<br/>
&nbsp;&nbsp;&nbsp;{<span class="id" title="var">heapUnfold</span>. <span class="id" title="tactic">destruct</span> (<span class="id" title="var">Nat.eq_dec</span> <span class="id" title="var">l</span> <span class="id" title="var">l0</span>). <span class="id" title="var">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">erewrite</span> <span class="id" title="var">updatecomm</span>; <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">econstructor</span>; <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;}<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
When acquiring a lock via a write, we should get a "similar" result
when validating the log before and after the write.  The "invalid" heaps
will be exactly the same, however, the valid heaps may differ by the 
value associated with the location we are writing.

</div>
<div class="code">
<span class="id" title="keyword">Theorem</span> <span class="id" title="var">validateAcquiredLock</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">tid</span> <span class="id" title="var">l</span> <span class="id" title="var">v</span> <span class="id" title="var">v'</span> <span class="id" title="var">b</span> <span class="id" title="var">rv</span> <span class="id" title="var">wv</span> <span class="id" title="var">e0</span> <span class="id" title="var">L</span> <span class="id" title="var">L'</span> <span class="id" title="var">H</span> <span class="id" title="var">lock</span> <span class="id" title="var">lock'</span> <span class="id" title="var">chkpnt</span> <span class="id" title="var">HI</span> <span class="id" title="var">HV</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">H</span> <span class="id" title="var">l</span> = <span class="id" title="var">Some</span>(<span class="id" title="var">v'</span>, <span class="id" title="var">lock</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">acquireLock</span> <span class="id" title="var">l</span> <span class="id" title="var">v'</span> <span class="id" title="var">tid</span> <span class="id" title="var">rv</span> <span class="id" title="var">L</span> <span class="id" title="var">lock</span> <span class="id" title="var">lock'</span> <span class="id" title="var">L'</span> -&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;@<span class="id" title="var">validate</span> <span class="id" title="var">tid</span> <span class="id" title="var">rv</span> <span class="id" title="var">wv</span> <span class="id" title="var">e0</span> <span class="id" title="var">true</span> <span class="id" title="var">L'</span> (<span class="id" title="var">update</span> <span class="id" title="var">H</span> <span class="id" title="var">l</span> <span class="id" title="var">v</span> <span class="id" title="var">lock'</span>) (<span class="id" title="var">commit</span> <span class="id" title="var">chkpnt</span> <span class="id" title="var">HI</span> <span class="id" title="var">HV</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exists</span> <span class="id" title="var">HV'</span>, @<span class="id" title="var">validate</span> <span class="id" title="var">tid</span> <span class="id" title="var">rv</span> <span class="id" title="var">wv</span> <span class="id" title="var">e0</span> <span class="id" title="var">b</span> <span class="id" title="var">L</span> <span class="id" title="var">H</span> (<span class="id" title="var">commit</span> <span class="id" title="var">chkpnt</span> <span class="id" title="var">HI</span> <span class="id" title="var">HV'</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">tid</span> <span class="id" title="var">l</span> <span class="id" title="var">v</span> <span class="id" title="var">v'</span> <span class="id" title="var">b</span> <span class="id" title="var">rv</span> <span class="id" title="var">wv</span> <span class="id" title="var">e0</span> <span class="id" title="var">L</span> <span class="id" title="var">L'</span> <span class="id" title="var">H</span> <span class="id" title="var">lock</span> <span class="id" title="var">lock'</span> <span class="id" title="var">chkpnt</span> <span class="id" title="var">HI</span> <span class="id" title="var">HV</span> <span class="id" title="var">H0</span> <span class="id" title="var">H1</span> <span class="id" title="var">H2</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">dependent</span> <span class="id" title="tactic">destruction</span> <span class="id" title="var">H1</span>.<br/>
&nbsp;&nbsp;{<span class="id" title="tactic">eapply</span> <span class="id" title="var">validateIn</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H1</span>; <span class="id" title="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;{<span class="id" title="var">invertHyp</span>. <span class="id" title="var">heapUnfold</span>. <span class="id" title="tactic">destruct</span> (<span class="id" title="var">Nat.eq_dec</span> <span class="id" title="var">l</span> <span class="id" title="var">l</span>).<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="var">invertEq</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">validateNotIn</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H7</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">constructor</span>. <span class="id" title="tactic">omega</span>. <span class="id" title="var">exfalso</span>; <span class="id" title="tactic">auto</span>. }<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
Analogous to validateNotIn but for aborts.  

</div>
<div class="code">
<span class="id" title="keyword">Theorem</span> <span class="id" title="var">abortNotIn</span> : <br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">tid</span> <span class="id" title="var">l</span> <span class="id" title="var">v</span> <span class="id" title="var">b</span> <span class="id" title="var">v''</span> <span class="id" title="var">lock'''</span> <span class="id" title="var">rv</span> <span class="id" title="var">wv</span> <span class="id" title="var">e0</span> <span class="id" title="var">L</span> <span class="id" title="var">H</span> <span class="id" title="var">lock'</span> <span class="id" title="var">chkpnt</span> <span class="id" title="var">HI</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Log.notIn</span> <span class="id" title="var">l</span> <span class="id" title="var">b</span> <span class="id" title="var">L</span> -&gt; <span class="id" title="var">H</span> <span class="id" title="var">l</span> = <span class="id" title="var">Some</span>(<span class="id" title="var">v''</span>, <span class="id" title="var">lock'''</span>) -&gt; <span class="id" title="var">validStamp</span> <span class="id" title="var">tid</span> <span class="id" title="var">rv</span> <span class="id" title="var">lock'''</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">locked</span> <span class="id" title="var">tid</span> <span class="id" title="var">lock'</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;@<span class="id" title="var">validate</span> <span class="id" title="var">tid</span> <span class="id" title="var">rv</span> <span class="id" title="var">wv</span> <span class="id" title="var">e0</span> <span class="id" title="var">b</span> <span class="id" title="var">L</span> (<span class="id" title="var">update</span> <span class="id" title="var">H</span> <span class="id" title="var">l</span> <span class="id" title="var">v</span> <span class="id" title="var">lock'</span>) (<span class="id" title="var">abort</span> <span class="id" title="var">chkpnt</span> <span class="id" title="var">HI</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;@<span class="id" title="var">validate</span> <span class="id" title="var">tid</span> <span class="id" title="var">rv</span> <span class="id" title="var">wv</span> <span class="id" title="var">e0</span> <span class="id" title="var">b</span> <span class="id" title="var">L</span> <span class="id" title="var">H</span> (<span class="id" title="var">abort</span> <span class="id" title="var">chkpnt</span> (<span class="id" title="var">update</span> <span class="id" title="var">HI</span> <span class="id" title="var">l</span> <span class="id" title="var">v''</span> <span class="id" title="var">lock'''</span>)).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="var">remember</span> (<span class="id" title="var">update</span> <span class="id" title="var">H</span> <span class="id" title="var">l</span> <span class="id" title="var">v</span> <span class="id" title="var">lock'</span>). <span class="id" title="var">remember</span> (<span class="id" title="var">abort</span> <span class="id" title="var">chkpnt</span> <span class="id" title="var">HI</span>).<br/>
&nbsp;&nbsp;<span class="id" title="var">genDeps</span>{{<span class="id" title="var">chkpnt</span>; <span class="id" title="var">HI</span>; <span class="id" title="var">H</span>; <span class="id" title="var">l</span>; <span class="id" title="var">v</span>; <span class="id" title="var">lock'</span>}}.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">H4</span>; <span class="id" title="tactic">intros</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">solve</span>[<span class="id" title="var">inv</span> <span class="id" title="var">Heqv0</span>].<br/>
&nbsp;&nbsp;{<span class="id" title="var">inv</span> <span class="id" title="var">Heqv0</span>. <span class="id" title="var">invertHyp</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">validateNotIn</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H5</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="var">heapUnfold</span>. <span class="id" title="tactic">destruct</span> (<span class="id" title="var">Nat.eq_dec</span> <span class="id" title="var">l0</span> <span class="id" title="var">l</span>).<br/>
&nbsp;&nbsp;&nbsp;{<span class="id" title="tactic">subst</span>. <span class="id" title="var">invertEq</span>. <span class="id" title="var">inv</span> <span class="id" title="var">H1</span>; <span class="id" title="var">exfalso</span>; <span class="id" title="tactic">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;{<span class="id" title="tactic">econstructor</span>; <span class="id" title="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<span class="id" title="var">inv</span> <span class="id" title="var">Heqv0</span>. <span class="id" title="var">invertHyp</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">validateNotIn</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H5</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="var">heapUnfold</span>. <span class="id" title="tactic">destruct</span> (<span class="id" title="var">Nat.eq_dec</span> <span class="id" title="var">l0</span> <span class="id" title="var">l</span>).<br/>
&nbsp;&nbsp;&nbsp;{<span class="id" title="tactic">subst</span>. <span class="id" title="var">invertEq</span>. <span class="id" title="var">inv</span> <span class="id" title="var">H1</span>; <span class="id" title="var">exfalso</span>; <span class="id" title="tactic">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;{<span class="id" title="tactic">econstructor</span>; <span class="id" title="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<span class="id" title="var">invertEq</span>. <span class="id" title="tactic">dependent</span> <span class="id" title="tactic">destruction</span> <span class="id" title="var">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;{<span class="id" title="var">invertHyp</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">IHvalidate</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H1</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">readPropAbort</span>; <span class="id" title="tactic">eauto</span>. <span class="id" title="tactic">constructor</span>. <span class="id" title="tactic">constructor</span>. }<br/>
&nbsp;&nbsp;&nbsp;{<span class="id" title="var">invertHyp</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">IHvalidate</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H1</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">readPropAbort</span>; <span class="id" title="tactic">eauto</span>. <span class="id" title="tactic">constructor</span>. <span class="id" title="tactic">constructor</span>. }<br/>
&nbsp;&nbsp;} <br/>
&nbsp;&nbsp;{<span class="id" title="var">invertHyp</span>. <span class="id" title="var">invertEq</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">IHvalidate</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H9</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="var">heapUnfold</span>. <span class="id" title="tactic">destruct</span> (<span class="id" title="var">Nat.eq_dec</span> <span class="id" title="var">l0</span> <span class="id" title="var">l</span>). <span class="id" title="var">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">updatecomm</span>; <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">writePropAbort</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eauto</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">constructor</span>. }<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
Analogous to `validateIn` for aborts

</div>
<div class="code">
<span class="id" title="keyword">Theorem</span> <span class="id" title="var">abortIn</span> :  <br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">tid</span> <span class="id" title="var">l</span> <span class="id" title="var">v</span> <span class="id" title="var">v''</span> <span class="id" title="var">rv</span> <span class="id" title="var">wv</span> <span class="id" title="var">e0</span> <span class="id" title="var">L</span> <span class="id" title="var">H</span> <span class="id" title="var">lock'</span> <span class="id" title="var">chkpnt</span> <span class="id" title="var">HI</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Log.In</span> <span class="id" title="var">l</span> <span class="id" title="var">L</span> -&gt; <span class="id" title="var">H</span> <span class="id" title="var">l</span> = <span class="id" title="var">Some</span>(<span class="id" title="var">v''</span>, <span class="id" title="var">lock'</span>) -&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;@<span class="id" title="var">validate</span> <span class="id" title="var">tid</span> <span class="id" title="var">rv</span> <span class="id" title="var">wv</span> <span class="id" title="var">e0</span> <span class="id" title="var">true</span> <span class="id" title="var">L</span> (<span class="id" title="var">update</span> <span class="id" title="var">H</span> <span class="id" title="var">l</span> <span class="id" title="var">v</span> <span class="id" title="var">lock'</span>) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">abort</span> <span class="id" title="var">chkpnt</span> <span class="id" title="var">HI</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;@<span class="id" title="var">validate</span> <span class="id" title="var">tid</span> <span class="id" title="var">rv</span> <span class="id" title="var">wv</span> <span class="id" title="var">e0</span> <span class="id" title="var">true</span> <span class="id" title="var">L</span> <span class="id" title="var">H</span> (<span class="id" title="var">abort</span> <span class="id" title="var">chkpnt</span> <span class="id" title="var">HI</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">dependent</span> <span class="id" title="tactic">induction</span> <span class="id" title="var">H2</span>.<br/>
&nbsp;&nbsp;{<span class="id" title="var">invertHyp</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">validateIn</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H0</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="var">heapUnfold</span>. <span class="id" title="tactic">destruct</span> (<span class="id" title="var">Nat.eq_dec</span> <span class="id" title="var">l</span> <span class="id" title="var">l0</span>).<br/>
&nbsp;&nbsp;&nbsp;{<span class="id" title="tactic">subst</span>. <span class="id" title="var">invertEq</span>. <span class="id" title="tactic">econstructor</span>; <span class="id" title="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;&nbsp;{<span class="id" title="tactic">econstructor</span>; <span class="id" title="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<span class="id" title="tactic">dependent</span> <span class="id" title="tactic">destruction</span> <span class="id" title="var">H3</span>. <span class="id" title="var">invertHyp</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">IHvalidate</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H0</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">readPropAbort</span>; <span class="id" title="tactic">eauto</span>. <span class="id" title="tactic">constructor</span>. }<br/>
&nbsp;&nbsp;{<span class="id" title="var">invertHyp</span>.<br/>
&nbsp;&nbsp;&nbsp;{<span class="id" title="var">heapUnfold</span>. <span class="id" title="tactic">destruct</span> (<span class="id" title="var">Nat.eq_dec</span> <span class="id" title="var">l0</span> <span class="id" title="var">l0</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id" title="var">invertEq</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">abortNotIn</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H0</span>; <span class="id" title="tactic">eauto</span>. <span class="id" title="var">erewrite</span> &lt;- <span class="id" title="var">updateUpdate</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">writePropAbort</span>; <span class="id" title="tactic">eauto</span>. <span class="id" title="tactic">constructor</span>. <span class="id" title="tactic">constructor</span>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{<span class="id" title="var">exfalso</span>; <span class="id" title="tactic">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;&nbsp;{<span class="id" title="tactic">eapply</span> <span class="id" title="var">IHvalidate</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H1</span>; <span class="id" title="tactic">eauto</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">writePropAbort</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">heapUnfold</span>. <span class="id" title="tactic">destruct</span> (<span class="id" title="var">Nat.eq_dec</span> <span class="id" title="var">l</span> <span class="id" title="var">l0</span>). <span class="id" title="var">contradiction</span>. <span class="id" title="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;}<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
Analogous to `validateAcquiredlock`

</div>
<div class="code">
<span class="id" title="keyword">Theorem</span> <span class="id" title="var">abortAcquiredLock</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">tid</span> <span class="id" title="var">l</span> <span class="id" title="var">v</span> <span class="id" title="var">v'</span> <span class="id" title="var">b</span> <span class="id" title="var">rv</span> <span class="id" title="var">wv</span> <span class="id" title="var">e0</span> <span class="id" title="var">L</span> <span class="id" title="var">L'</span> <span class="id" title="var">H</span> <span class="id" title="var">lock</span> <span class="id" title="var">lock'</span> <span class="id" title="var">chkpnt</span> <span class="id" title="var">HI</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">H</span> <span class="id" title="var">l</span> = <span class="id" title="var">Some</span>(<span class="id" title="var">v'</span>, <span class="id" title="var">lock</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">acquireLock</span> <span class="id" title="var">l</span> <span class="id" title="var">v'</span> <span class="id" title="var">tid</span> <span class="id" title="var">rv</span> <span class="id" title="var">L</span> <span class="id" title="var">lock</span> <span class="id" title="var">lock'</span> <span class="id" title="var">L'</span> -&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;@<span class="id" title="var">validate</span> <span class="id" title="var">tid</span> <span class="id" title="var">rv</span> <span class="id" title="var">wv</span> <span class="id" title="var">e0</span> <span class="id" title="var">true</span> <span class="id" title="var">L'</span> (<span class="id" title="var">update</span> <span class="id" title="var">H</span> <span class="id" title="var">l</span> <span class="id" title="var">v</span> <span class="id" title="var">lock'</span>) (<span class="id" title="var">abort</span> <span class="id" title="var">chkpnt</span> <span class="id" title="var">HI</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;@<span class="id" title="var">validate</span> <span class="id" title="var">tid</span> <span class="id" title="var">rv</span> <span class="id" title="var">wv</span> <span class="id" title="var">e0</span> <span class="id" title="var">b</span> <span class="id" title="var">L</span> <span class="id" title="var">H</span> (<span class="id" title="var">abort</span> <span class="id" title="var">chkpnt</span> <span class="id" title="var">HI</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">dependent</span> <span class="id" title="tactic">destruction</span> <span class="id" title="var">H1</span>.<br/>
&nbsp;&nbsp;{<span class="id" title="tactic">eapply</span> <span class="id" title="var">abortIn</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H2</span>; <span class="id" title="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;{<span class="id" title="var">invertHyp</span>. <span class="id" title="tactic">dependent</span> <span class="id" title="tactic">destruction</span> <span class="id" title="var">H5</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="var">heapUnfold</span>. <span class="id" title="tactic">destruct</span> (<span class="id" title="var">Nat.eq_dec</span> <span class="id" title="var">l</span> <span class="id" title="var">l</span>). <span class="id" title="var">invertEq</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">abortNotIn</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H2</span>; <span class="id" title="tactic">eauto</span>. <span class="id" title="tactic">constructor</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="var">exfalso</span>; <span class="id" title="tactic">auto</span>. }<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
Reverse direction of above 

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Theorem</span> <span class="id" title="var">validateNotInRev</span> : <br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">tid</span> <span class="id" title="var">l</span> <span class="id" title="var">v</span> <span class="id" title="var">b</span> <span class="id" title="var">v''</span> <span class="id" title="var">lock'''</span> <span class="id" title="var">rv</span> <span class="id" title="var">wv</span> <span class="id" title="var">e0</span> <span class="id" title="var">L</span> <span class="id" title="var">H</span> <span class="id" title="var">lock'</span> <span class="id" title="var">chkpnt</span> <span class="id" title="var">HI</span> <span class="id" title="var">HV</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Log.notIn</span> <span class="id" title="var">l</span> <span class="id" title="var">b</span> <span class="id" title="var">L</span> -&gt; <span class="id" title="var">H</span> <span class="id" title="var">l</span> = <span class="id" title="var">Some</span>(<span class="id" title="var">v''</span>, <span class="id" title="var">lock'''</span>) -&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;@<span class="id" title="var">validate</span> <span class="id" title="var">tid</span> <span class="id" title="var">rv</span> <span class="id" title="var">wv</span> <span class="id" title="var">e0</span> <span class="id" title="var">b</span> <span class="id" title="var">L</span> <span class="id" title="var">H</span> (<span class="id" title="var">commit</span> <span class="id" title="var">chkpnt</span> <span class="id" title="var">HI</span> <span class="id" title="var">HV</span>) -&gt; <span class="id" title="var">locked</span> <span class="id" title="var">tid</span> <span class="id" title="var">lock'</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;@<span class="id" title="var">validate</span> <span class="id" title="var">tid</span> <span class="id" title="var">rv</span> <span class="id" title="var">wv</span> <span class="id" title="var">e0</span> <span class="id" title="var">b</span> <span class="id" title="var">L</span> (<span class="id" title="var">update</span> <span class="id" title="var">H</span> <span class="id" title="var">l</span> <span class="id" title="var">v</span> <span class="id" title="var">lock'</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">commit</span> <span class="id" title="var">chkpnt</span> (<span class="id" title="var">update</span> <span class="id" title="var">HI</span> <span class="id" title="var">l</span> <span class="id" title="var">v</span> <span class="id" title="var">lock'</span>) (<span class="id" title="var">update</span> <span class="id" title="var">HV</span> <span class="id" title="var">l</span> <span class="id" title="var">v</span> <span class="id" title="var">lock'</span>)).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="var">remember</span> (<span class="id" title="var">commit</span> <span class="id" title="var">chkpnt</span> <span class="id" title="var">HI</span> <span class="id" title="var">HV</span>).<br/>
&nbsp;&nbsp;<span class="id" title="var">genDeps</span>{{<span class="id" title="var">chkpnt</span>; <span class="id" title="var">HI</span>; <span class="id" title="var">HV</span>; <span class="id" title="var">l</span>; <span class="id" title="var">lock'''</span>; <span class="id" title="var">v''</span>; <span class="id" title="var">lock'</span>}}.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">H2</span>; <span class="id" title="tactic">intros</span>; <span class="id" title="var">inv</span> <span class="id" title="var">Heqv0</span>.<br/>
&nbsp;&nbsp;{<span class="id" title="tactic">constructor</span>. }<br/>
&nbsp;&nbsp;{<span class="id" title="var">invertHyp</span>. <span class="id" title="tactic">destruct</span> (<span class="id" title="var">Nat.eq_dec</span> <span class="id" title="var">l</span> <span class="id" title="var">l0</span>).<br/>
&nbsp;&nbsp;&nbsp;{<span class="id" title="tactic">subst</span>. <span class="id" title="tactic">econstructor</span>. <span class="id" title="var">heapUnfold</span>. <span class="id" title="var">simplEq</span> <span class="id" title="var">l0</span> <span class="id" title="var">l0</span>. <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">constructor</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">IHvalidate</span>; <span class="id" title="tactic">eauto</span>. <span class="id" title="tactic">constructor</span>. }<br/>
&nbsp;&nbsp;&nbsp;{<span class="id" title="tactic">econstructor</span>; <span class="id" title="tactic">eauto</span>. <span class="id" title="var">heapUnfold</span>. <span class="id" title="var">simplEq</span> <span class="id" title="var">l0</span> <span class="id" title="var">l</span>. <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">IHvalidate</span>; <span class="id" title="tactic">eauto</span>. <span class="id" title="tactic">constructor</span>. }<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<span class="id" title="var">invertHyp</span>. <span class="id" title="tactic">destruct</span> (<span class="id" title="var">Nat.eq_dec</span> <span class="id" title="var">l</span> <span class="id" title="var">l0</span>).<br/>
&nbsp;&nbsp;&nbsp;{<span class="id" title="tactic">subst</span>. <span class="id" title="tactic">econstructor</span>. <span class="id" title="var">heapUnfold</span>. <span class="id" title="var">simplEq</span> <span class="id" title="var">l0</span> <span class="id" title="var">l0</span>. <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">constructor</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">IHvalidate</span>; <span class="id" title="tactic">eauto</span>. <span class="id" title="tactic">constructor</span>. }<br/>
&nbsp;&nbsp;&nbsp;{<span class="id" title="tactic">econstructor</span>; <span class="id" title="tactic">eauto</span>. <span class="id" title="var">heapUnfold</span>. <span class="id" title="var">simplEq</span> <span class="id" title="var">l0</span> <span class="id" title="var">l</span>. <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">IHvalidate</span>; <span class="id" title="tactic">eauto</span>. <span class="id" title="tactic">constructor</span>. }<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<span class="id" title="var">invertHyp</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">updatecomm</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">updatecomm</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">l</span> := <span class="id" title="var">l</span>) (<span class="id" title="var">l'</span> := <span class="id" title="var">l0</span>). <span class="id" title="tactic">econstructor</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="var">heapUnfold</span>. <span class="id" title="var">simplEq</span> <span class="id" title="var">l0</span> <span class="id" title="var">l</span>. <span class="id" title="tactic">assumption</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">IHvalidate</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">constructor</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">neqSymm</span>; <span class="id" title="tactic">assumption</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">neqSymm</span>. <span class="id" title="tactic">auto</span>. }<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Theorem</span> <span class="id" title="var">validateInRev</span> :  <br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">tid</span> <span class="id" title="var">l</span> <span class="id" title="var">v</span> <span class="id" title="var">v''</span> <span class="id" title="var">rv</span> <span class="id" title="var">wv</span> <span class="id" title="var">e0</span> <span class="id" title="var">L</span> <span class="id" title="var">H</span> <span class="id" title="var">lock'</span> <span class="id" title="var">chkpnt</span> <span class="id" title="var">HI</span> <span class="id" title="var">HV</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Log.In</span> <span class="id" title="var">l</span> <span class="id" title="var">L</span> -&gt; <span class="id" title="var">H</span> <span class="id" title="var">l</span> = <span class="id" title="var">Some</span>(<span class="id" title="var">v''</span>, <span class="id" title="var">lock'</span>) -&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;@<span class="id" title="var">validate</span> <span class="id" title="var">tid</span> <span class="id" title="var">rv</span> <span class="id" title="var">wv</span> <span class="id" title="var">e0</span> <span class="id" title="var">true</span> <span class="id" title="var">L</span> <span class="id" title="var">H</span> (<span class="id" title="var">commit</span> <span class="id" title="var">chkpnt</span> <span class="id" title="var">HI</span> <span class="id" title="var">HV</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">locked</span> <span class="id" title="var">tid</span> <span class="id" title="var">lock'</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;@<span class="id" title="var">validate</span> <span class="id" title="var">tid</span> <span class="id" title="var">rv</span> <span class="id" title="var">wv</span> <span class="id" title="var">e0</span> <span class="id" title="var">true</span> <span class="id" title="var">L</span> (<span class="id" title="var">update</span> <span class="id" title="var">H</span> <span class="id" title="var">l</span> <span class="id" title="var">v</span> <span class="id" title="var">lock'</span>) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">commit</span> <span class="id" title="var">chkpnt</span> <span class="id" title="var">HI</span> (<span class="id" title="var">update</span> <span class="id" title="var">HV</span> <span class="id" title="var">l</span> <span class="id" title="var">v</span> (<span class="id" title="var">Unlocked</span> <span class="id" title="var">wv</span>))).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="var">genDeps</span>{{<span class="id" title="var">v''</span>; <span class="id" title="var">lock'</span>; <span class="id" title="var">v</span>}}. <span class="id" title="tactic">dependent</span> <span class="id" title="tactic">induction</span> <span class="id" title="var">H2</span>; <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;{<span class="id" title="var">invertHyp</span>. <span class="id" title="tactic">destruct</span> (<span class="id" title="var">Nat.eq_dec</span> <span class="id" title="var">l</span> <span class="id" title="var">l0</span>).<br/>
&nbsp;&nbsp;&nbsp;{<span class="id" title="tactic">econstructor</span>. <span class="id" title="var">heapUnfold</span>. <span class="id" title="tactic">subst</span>. <span class="id" title="var">simplEq</span> <span class="id" title="var">l0</span> <span class="id" title="var">l0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eauto</span>. <span class="id" title="tactic">constructor</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">IHvalidate</span>; <span class="id" title="tactic">eauto</span>. <span class="id" title="tactic">constructor</span>. }<br/>
&nbsp;&nbsp;&nbsp;{<span class="id" title="tactic">econstructor</span>; <span class="id" title="tactic">eauto</span>. <span class="id" title="var">heapUnfold</span>. <span class="id" title="var">simplEq</span> <span class="id" title="var">l</span> <span class="id" title="var">l0</span>. <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">IHvalidate</span>; <span class="id" title="tactic">eauto</span>. <span class="id" title="tactic">constructor</span>. }<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<span class="id" title="var">invertHyp</span>.<br/>
&nbsp;&nbsp;&nbsp;{<span class="id" title="var">transEq</span>. <span class="id" title="var">invertEq</span>. <span class="id" title="var">erewrite</span> &lt;- <span class="id" title="var">updateUpdate</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">H</span> := <span class="id" title="var">HI0</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">erewrite</span> &lt;- <span class="id" title="var">updateUpdate</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">H</span> := (<span class="id" title="var">update</span> <span class="id" title="var">HV0</span> <span class="id" title="var">l0</span> <span class="id" title="var">v''</span> (<span class="id" title="var">Unlocked</span> <span class="id" title="var">wv</span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">updateUpdate</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">H</span> := <span class="id" title="var">HV0</span>). <span class="id" title="tactic">econstructor</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">heapUnfold</span>. <span class="id" title="var">simplEq</span> <span class="id" title="var">l0</span> <span class="id" title="var">l0</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">validateNotInRev</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">constructor</span>. }<br/>
&nbsp;&nbsp;&nbsp;{<span class="id" title="tactic">rewrite</span> <span class="id" title="var">updatecomm</span>; <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">econstructor</span>; <span class="id" title="tactic">auto</span>. <span class="id" title="var">heapUnfold</span>. <span class="id" title="var">simplEq</span> <span class="id" title="var">l</span> <span class="id" title="var">l0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assumption</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">IHvalidate</span>; <span class="id" title="tactic">eauto</span>. <span class="id" title="tactic">constructor</span>. }<br/>
&nbsp;&nbsp;}<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Theorem</span> <span class="id" title="var">validateNotInLookup</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">b</span> <span class="id" title="var">tid</span> <span class="id" title="var">rv</span> <span class="id" title="var">wv</span> <span class="id" title="var">e0</span> <span class="id" title="var">L</span> <span class="id" title="var">H</span> <span class="id" title="var">res</span> <span class="id" title="var">l</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;@<span class="id" title="var">validate</span> <span class="id" title="var">tid</span> <span class="id" title="var">rv</span> <span class="id" title="var">wv</span> <span class="id" title="var">e0</span> <span class="id" title="var">b</span> <span class="id" title="var">L</span> <span class="id" title="var">H</span> <span class="id" title="var">res</span> -&gt; <span class="id" title="var">Log.notIn</span> <span class="id" title="var">l</span> <span class="id" title="var">b</span> <span class="id" title="var">L</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">H</span> <span class="id" title="var">l</span> = (<span class="id" title="var">invalidHeap</span> <span class="id" title="var">res</span>) <span class="id" title="var">l</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">H0</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">solve</span>[<span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> *; <span class="id" title="tactic">dependent</span> <span class="id" title="tactic">destruction</span> <span class="id" title="var">H1</span>; <span class="id" title="tactic">eauto</span>].<br/>
&nbsp;&nbsp;{<span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> *. <span class="id" title="tactic">dependent</span> <span class="id" title="tactic">destruction</span> <span class="id" title="var">H1</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">update</span>. <span class="id" title="var">simplEq</span> <span class="id" title="var">l0</span> <span class="id" title="var">l</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">auto</span>. }<br/>
&nbsp;&nbsp;{<span class="id" title="tactic">dependent</span> <span class="id" title="tactic">destruction</span> <span class="id" title="var">H2</span>. <span class="id" title="var">invertHyp</span>. <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="var">invertHyp</span>. <span class="id" title="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;{<span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> *. <span class="id" title="var">invertHyp</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">update</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="var">simplEq</span> <span class="id" title="var">l0</span> <span class="id" title="var">l</span>. <span class="id" title="tactic">auto</span>. }<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Theorem</span> <span class="id" title="var">validateAcquiredLockRev</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">tid</span> <span class="id" title="var">l</span> <span class="id" title="var">v</span> <span class="id" title="var">v'</span> <span class="id" title="var">b</span> <span class="id" title="var">rv</span> <span class="id" title="var">wv</span> <span class="id" title="var">e0</span> <span class="id" title="var">L</span> <span class="id" title="var">L'</span> <span class="id" title="var">H</span> <span class="id" title="var">lock</span> <span class="id" title="var">lock'</span> <span class="id" title="var">chkpnt</span> <span class="id" title="var">HI</span> <span class="id" title="var">HV</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">H</span> <span class="id" title="var">l</span> = <span class="id" title="var">Some</span>(<span class="id" title="var">v'</span>, <span class="id" title="var">lock</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">acquireLock</span> <span class="id" title="var">l</span> <span class="id" title="var">v'</span> <span class="id" title="var">tid</span> <span class="id" title="var">rv</span> <span class="id" title="var">L</span> <span class="id" title="var">lock</span> <span class="id" title="var">lock'</span> <span class="id" title="var">L'</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;@<span class="id" title="var">validate</span> <span class="id" title="var">tid</span> <span class="id" title="var">rv</span> <span class="id" title="var">wv</span> <span class="id" title="var">e0</span> <span class="id" title="var">b</span> <span class="id" title="var">L</span> <span class="id" title="var">H</span> (<span class="id" title="var">commit</span> <span class="id" title="var">chkpnt</span> <span class="id" title="var">HI</span> <span class="id" title="var">HV</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exists</span> <span class="id" title="var">HV'</span>, @<span class="id" title="var">validate</span> <span class="id" title="var">tid</span> <span class="id" title="var">rv</span> <span class="id" title="var">wv</span> <span class="id" title="var">e0</span> <span class="id" title="var">true</span> <span class="id" title="var">L'</span> (<span class="id" title="var">update</span> <span class="id" title="var">H</span> <span class="id" title="var">l</span> <span class="id" title="var">v</span> <span class="id" title="var">lock'</span>) (<span class="id" title="var">commit</span> <span class="id" title="var">chkpnt</span> <span class="id" title="var">HI</span> <span class="id" title="var">HV'</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">dependent</span> <span class="id" title="tactic">destruction</span> <span class="id" title="var">H1</span>.<br/>
&nbsp;&nbsp;{<span class="id" title="tactic">eapply</span> <span class="id" title="var">validateInRev</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H2</span>; <span class="id" title="tactic">eauto</span>. <span class="id" title="tactic">constructor</span>. }<br/>
&nbsp;&nbsp;{<span class="id" title="var">copy</span> <span class="id" title="var">H3</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">validateNotInRev</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H3</span>; <span class="id" title="tactic">eauto</span>. <span class="id" title="var">Focus</span> 2. <span class="id" title="tactic">constructor</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">replace</span> <span class="id" title="var">HI</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">update</span> (<span class="id" title="var">update</span> <span class="id" title="var">HI</span> <span class="id" title="var">l</span> <span class="id" title="var">v</span> (<span class="id" title="var">Locked</span> <span class="id" title="var">tid</span> <span class="id" title="var">S'</span> <span class="id" title="var">v'</span>)) <span class="id" title="var">l</span> <span class="id" title="var">v'</span> (<span class="id" title="var">Unlocked</span> <span class="id" title="var">S'</span>)). <span class="id" title="tactic">econstructor</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">econstructor</span>. <span class="id" title="var">heapUnfold</span>. <span class="id" title="var">simplEq</span> <span class="id" title="var">l</span> <span class="id" title="var">l</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">auto</span>. <span class="id" title="tactic">eauto</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">updateUpdate</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">updateIdempotent</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">validateNotInLookup</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H4</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> *. <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">H4</span>. <span class="id" title="tactic">assumption</span>. }<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Theorem</span> <span class="id" title="var">abortNotInRev</span> : <br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">tid</span> <span class="id" title="var">l</span> <span class="id" title="var">v</span> <span class="id" title="var">b</span> <span class="id" title="var">v''</span> <span class="id" title="var">lock'''</span> <span class="id" title="var">rv</span> <span class="id" title="var">wv</span> <span class="id" title="var">e0</span> <span class="id" title="var">L</span> <span class="id" title="var">H</span> <span class="id" title="var">lock'</span> <span class="id" title="var">chkpnt</span> <span class="id" title="var">HI</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Log.notIn</span> <span class="id" title="var">l</span> <span class="id" title="var">b</span> <span class="id" title="var">L</span> -&gt; <span class="id" title="var">H</span> <span class="id" title="var">l</span> = <span class="id" title="var">Some</span>(<span class="id" title="var">v''</span>, <span class="id" title="var">lock'''</span>) -&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;@<span class="id" title="var">validate</span> <span class="id" title="var">tid</span> <span class="id" title="var">rv</span> <span class="id" title="var">wv</span> <span class="id" title="var">e0</span> <span class="id" title="var">b</span> <span class="id" title="var">L</span> <span class="id" title="var">H</span> (<span class="id" title="var">abort</span> <span class="id" title="var">chkpnt</span> <span class="id" title="var">HI</span>) -&gt; <span class="id" title="var">locked</span> <span class="id" title="var">tid</span> <span class="id" title="var">lock'</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">validStamp</span> <span class="id" title="var">tid</span> <span class="id" title="var">rv</span> <span class="id" title="var">lock'''</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;@<span class="id" title="var">validate</span> <span class="id" title="var">tid</span> <span class="id" title="var">rv</span> <span class="id" title="var">wv</span> <span class="id" title="var">e0</span> <span class="id" title="var">b</span> <span class="id" title="var">L</span> (<span class="id" title="var">update</span> <span class="id" title="var">H</span> <span class="id" title="var">l</span> <span class="id" title="var">v</span> <span class="id" title="var">lock'</span>) (<span class="id" title="var">abort</span> <span class="id" title="var">chkpnt</span> (<span class="id" title="var">update</span> <span class="id" title="var">HI</span> <span class="id" title="var">l</span> <span class="id" title="var">v</span> <span class="id" title="var">lock'</span>)).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="var">remember</span> (<span class="id" title="var">abort</span> <span class="id" title="var">chkpnt</span> <span class="id" title="var">HI</span>).<br/>
&nbsp;&nbsp;<span class="id" title="var">genDeps</span>{{<span class="id" title="var">chkpnt</span>; <span class="id" title="var">HI</span>; <span class="id" title="var">l</span>; <span class="id" title="var">v</span>; <span class="id" title="var">v''</span>; <span class="id" title="var">lock'''</span>; <span class="id" title="var">lock'</span>}}.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">H2</span>; <span class="id" title="tactic">intros</span>; <span class="id" title="var">inv</span> <span class="id" title="var">Heqv0</span>.<br/>
&nbsp;&nbsp;{<span class="id" title="var">invertHyp</span>. <span class="id" title="tactic">destruct</span> (<span class="id" title="var">Nat.eq_dec</span> <span class="id" title="var">l</span> <span class="id" title="var">l0</span>).<br/>
&nbsp;&nbsp;&nbsp;{<span class="id" title="tactic">subst</span>. <span class="id" title="var">exfalso</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">validInvalidStamp</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">transEq</span>. <span class="id" title="var">invertEq</span>. <span class="id" title="tactic">assumption</span>. }<br/>
&nbsp;&nbsp;&nbsp;{<span class="id" title="tactic">eapply</span> <span class="id" title="var">validateNotInRev</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H2</span>; <span class="id" title="tactic">eauto</span>. <span class="id" title="tactic">econstructor</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">heapUnfold</span>. <span class="id" title="var">simplEq</span> <span class="id" title="var">l0</span> <span class="id" title="var">l</span>. <span class="id" title="tactic">eauto</span>. <span class="id" title="tactic">constructor</span>. }<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<span class="id" title="tactic">dependent</span> <span class="id" title="tactic">destruction</span> <span class="id" title="var">H5</span>. <span class="id" title="tactic">destruct</span> (<span class="id" title="var">Nat.eq_dec</span> <span class="id" title="var">l</span> <span class="id" title="var">l0</span>).<br/>
&nbsp;&nbsp;&nbsp;{<span class="id" title="tactic">subst</span>. <span class="id" title="var">exfalso</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">validInvalidStamp</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">transEq</span>. <span class="id" title="var">invertEq</span>. <span class="id" title="tactic">assumption</span>. }<br/>
&nbsp;&nbsp;&nbsp;{<span class="id" title="tactic">eapply</span> <span class="id" title="var">validateNotInRev</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H2</span>; <span class="id" title="tactic">eauto</span>. <span class="id" title="var">invertHyp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">econstructor</span>; <span class="id" title="tactic">eauto</span>. <span class="id" title="var">heapUnfold</span>. <span class="id" title="var">simplEq</span> <span class="id" title="var">l0</span> <span class="id" title="var">l</span>. <span class="id" title="tactic">eauto</span>. }<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<span class="id" title="tactic">eapply</span> <span class="id" title="var">readPropAbort</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">IHvalidate</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">dependent</span> <span class="id" title="tactic">destruction</span> <span class="id" title="var">H0</span>; <span class="id" title="var">invertHyp</span>; <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">auto</span>. }<br/>
&nbsp;&nbsp;{<span class="id" title="var">invertHyp</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">updatecomm</span>; <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">writePropAbort</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">IHvalidate</span>; <span class="id" title="tactic">eauto</span>. <span class="id" title="tactic">constructor</span>. <span class="id" title="var">heapUnfold</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="var">simplEq</span> <span class="id" title="var">l0</span> <span class="id" title="var">l</span>. <span class="id" title="tactic">eauto</span>. }<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Theorem</span> <span class="id" title="var">abortInRev</span> :  <br/>
&nbsp;&nbsp;<span class="id" title="keyword">forall</span> <span class="id" title="var">tid</span> <span class="id" title="var">l</span> <span class="id" title="var">v</span> <span class="id" title="var">v''</span> <span class="id" title="var">rv</span> <span class="id" title="var">wv</span> <span class="id" title="var">e0</span> <span class="id" title="var">L</span> <span class="id" title="var">H</span> <span class="id" title="var">lock'</span> <span class="id" title="var">chkpnt</span> <span class="id" title="var">HI</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Log.In</span> <span class="id" title="var">l</span> <span class="id" title="var">L</span> -&gt; <span class="id" title="var">H</span> <span class="id" title="var">l</span> = <span class="id" title="var">Some</span>(<span class="id" title="var">v''</span>, <span class="id" title="var">lock'</span>) -&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;@<span class="id" title="var">validate</span> <span class="id" title="var">tid</span> <span class="id" title="var">rv</span> <span class="id" title="var">wv</span> <span class="id" title="var">e0</span> <span class="id" title="var">true</span> <span class="id" title="var">L</span> <span class="id" title="var">H</span> (<span class="id" title="var">abort</span> <span class="id" title="var">chkpnt</span> <span class="id" title="var">HI</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">locked</span> <span class="id" title="var">tid</span> <span class="id" title="var">lock'</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;@<span class="id" title="var">validate</span> <span class="id" title="var">tid</span> <span class="id" title="var">rv</span> <span class="id" title="var">wv</span> <span class="id" title="var">e0</span> <span class="id" title="var">true</span> <span class="id" title="var">L</span> (<span class="id" title="var">update</span> <span class="id" title="var">H</span> <span class="id" title="var">l</span> <span class="id" title="var">v</span> <span class="id" title="var">lock'</span>) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">abort</span> <span class="id" title="var">chkpnt</span> <span class="id" title="var">HI</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="var">genDeps</span>{{<span class="id" title="var">v</span>; <span class="id" title="var">v''</span>; <span class="id" title="var">lock'</span>; <span class="id" title="var">l</span>}}. <span class="id" title="tactic">dependent</span> <span class="id" title="tactic">induction</span> <span class="id" title="var">H2</span>; <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;{<span class="id" title="var">invertHyp</span>. <span class="id" title="tactic">destruct</span> (<span class="id" title="var">Nat.eq_dec</span> <span class="id" title="var">l</span> <span class="id" title="var">l0</span>).<br/>
&nbsp;&nbsp;&nbsp;{<span class="id" title="tactic">subst</span>. <span class="id" title="var">transEq</span>. <span class="id" title="var">invertEq</span>. <span class="id" title="var">invertHyp</span>. <span class="id" title="var">exfalso</span>; <span class="id" title="tactic">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;{<span class="id" title="tactic">eapply</span> <span class="id" title="var">validateInRev</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H2</span>; <span class="id" title="tactic">eauto</span>. <span class="id" title="tactic">econstructor</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">heapUnfold</span>. <span class="id" title="var">simplEq</span> <span class="id" title="var">l0</span> <span class="id" title="var">l</span>. <span class="id" title="tactic">eauto</span>. <span class="id" title="tactic">constructor</span>. }<br/>
&nbsp;&nbsp;}<br/>
&nbsp;&nbsp;{<span class="id" title="tactic">eapply</span> <span class="id" title="var">readPropAbort</span>; <span class="id" title="tactic">eauto</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">IHvalidate</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">dependent</span> <span class="id" title="tactic">destruction</span> <span class="id" title="var">H0</span>; <span class="id" title="var">invertHyp</span>; <span class="id" title="tactic">auto</span>. }<br/>
&nbsp;&nbsp;{<span class="id" title="var">invertHyp</span>.<br/>
&nbsp;&nbsp;&nbsp;{<span class="id" title="var">transEq</span>. <span class="id" title="var">invertEq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">replace</span> (<span class="id" title="var">update</span> <span class="id" title="var">HI0</span> <span class="id" title="var">l</span> <span class="id" title="var">v1</span> (<span class="id" title="var">Unlocked</span> <span class="id" title="var">oldV0</span>)) <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">update</span> (<span class="id" title="var">update</span> <span class="id" title="var">HI0</span> <span class="id" title="var">l</span> <span class="id" title="var">v0</span> (<span class="id" title="var">Locked</span> <span class="id" title="var">tid</span> <span class="id" title="var">oldV0</span> <span class="id" title="var">v1</span>)) <span class="id" title="var">l</span> <span class="id" title="var">v1</span> (<span class="id" title="var">Unlocked</span> <span class="id" title="var">oldV0</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">writePropAbort</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">abortNotInRev</span>; <span class="id" title="tactic">eauto</span>. <span class="id" title="tactic">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">constructor</span>. <span class="id" title="var">heapUnfold</span>. <span class="id" title="var">simplEq</span> <span class="id" title="var">l</span> <span class="id" title="var">l</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">updateUpdate</span>. <span class="id" title="tactic">auto</span>. }<br/>
&nbsp;&nbsp;&nbsp;{<span class="id" title="tactic">eapply</span> <span class="id" title="var">writePropAbort</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">IHvalidate</span>; <span class="id" title="tactic">eauto</span>. <span class="id" title="tactic">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">heapUnfold</span>. <span class="id" title="var">simplEq</span> <span class="id" title="var">l0</span> <span class="id" title="var">l</span>. <span class="id" title="tactic">eauto</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">auto</span>. }<br/>
&nbsp;&nbsp;}<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Theorem</span> <span class="id" title="var">abortAcquiredLockRev</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">tid</span> <span class="id" title="var">l</span> <span class="id" title="var">v</span> <span class="id" title="var">v'</span> <span class="id" title="var">b</span> <span class="id" title="var">rv</span> <span class="id" title="var">wv</span> <span class="id" title="var">e0</span> <span class="id" title="var">L</span> <span class="id" title="var">L'</span> <span class="id" title="var">H</span> <span class="id" title="var">lock</span> <span class="id" title="var">lock'</span> <span class="id" title="var">chkpnt</span> <span class="id" title="var">HI</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">H</span> <span class="id" title="var">l</span> = <span class="id" title="var">Some</span>(<span class="id" title="var">v'</span>, <span class="id" title="var">lock</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">acquireLock</span> <span class="id" title="var">l</span> <span class="id" title="var">v'</span> <span class="id" title="var">tid</span> <span class="id" title="var">rv</span> <span class="id" title="var">L</span> <span class="id" title="var">lock</span> <span class="id" title="var">lock'</span> <span class="id" title="var">L'</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;@<span class="id" title="var">validate</span> <span class="id" title="var">tid</span> <span class="id" title="var">rv</span> <span class="id" title="var">wv</span> <span class="id" title="var">e0</span> <span class="id" title="var">b</span> <span class="id" title="var">L</span> <span class="id" title="var">H</span> (<span class="id" title="var">abort</span> <span class="id" title="var">chkpnt</span> <span class="id" title="var">HI</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;@<span class="id" title="var">validate</span> <span class="id" title="var">tid</span> <span class="id" title="var">rv</span> <span class="id" title="var">wv</span> <span class="id" title="var">e0</span> <span class="id" title="var">true</span> <span class="id" title="var">L'</span> (<span class="id" title="var">update</span> <span class="id" title="var">H</span> <span class="id" title="var">l</span> <span class="id" title="var">v</span> <span class="id" title="var">lock'</span>) (<span class="id" title="var">abort</span> <span class="id" title="var">chkpnt</span> <span class="id" title="var">HI</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">dependent</span> <span class="id" title="tactic">destruction</span> <span class="id" title="var">H1</span>.<br/>
&nbsp;&nbsp;{<span class="id" title="tactic">eapply</span> <span class="id" title="var">abortInRev</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H2</span>; <span class="id" title="tactic">eauto</span>. <span class="id" title="tactic">constructor</span>. }<br/>
&nbsp;&nbsp;{<span class="id" title="var">copy</span> <span class="id" title="var">H3</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">abortNotInRev</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H3</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">replace</span> <span class="id" title="var">HI</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">update</span>(<span class="id" title="var">update</span> <span class="id" title="var">HI</span> <span class="id" title="var">l</span> <span class="id" title="var">v</span> (<span class="id" title="var">Locked</span> <span class="id" title="var">tid</span> <span class="id" title="var">S'</span> <span class="id" title="var">v'</span>)) <span class="id" title="var">l</span> <span class="id" title="var">v'</span> (<span class="id" title="var">Unlocked</span> <span class="id" title="var">S'</span>)).<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="var">Focus</span> 2. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">updateUpdate</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">updateIdempotent</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span>  <span class="id" title="var">validateNotInLookup</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H4</span>; <span class="id" title="tactic">eauto</span>. <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H4</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">H4</span>. <span class="id" title="tactic">assumption</span>. <span class="id" title="tactic">eapply</span> <span class="id" title="var">writePropAbort</span>. <span class="id" title="tactic">eauto</span>. <span class="id" title="var">heapUnfold</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="id" title="var">simplEq</span> <span class="id" title="var">l</span> <span class="id" title="var">l</span>. <span class="id" title="tactic">eauto</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="tactic">constructor</span>. <span class="id" title="tactic">constructor</span>. <span class="id" title="tactic">auto</span>. }<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>
</div>

<div id="footer">
<hr/><a href="index.html">Index</a><hr/>This page has been generated by <a href="http://coq.inria.fr/">coqdoc</a>
</div>

</div>

</body>
</html>